{% extends "base.html" %}

{% block title %}Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
{% endblock %}

{% block content %}
<div class="card">
    <h1>Админка</h1>
    <a class="btn" href="{{ url_for('admin_new_character') }}">Добавить персонажа</a>
    <table class="admin-table">
        <thead>
        <tr>
            {% set next_id_dir = 'desc' if sort == 'id' and direction == 'asc' else 'asc' %}
            {% set next_name_dir = 'desc' if sort == 'name' and direction == 'asc' else 'asc' %}
            {% set next_class_dir = 'desc' if sort == 'class_name' and direction == 'asc' else 'asc' %}
            {% set next_faction_dir = 'desc' if sort == 'faction' and direction == 'asc' else 'asc' %}
            {% set next_overall_dir = 'desc' if sort == 'overall_tier' and direction == 'asc' else 'asc' %}
            <th>
                <a class="sort-link{% if sort == 'id' %} active{% endif %}"
                   href="{{ url_for('admin_dashboard', sort='id', direction=next_id_dir) }}">
                    ID
                    {% if sort == 'id' %}
                        <span class="sort-indicator">{{ '↑' if direction == 'asc' else '↓' }}</span>
                    {% endif %}
                </a>
            </th>
            <th>
                <a class="sort-link{% if sort == 'name' %} active{% endif %}"
                   href="{{ url_for('admin_dashboard', sort='name', direction=next_name_dir) }}">
                    Имя
                    {% if sort == 'name' %}
                        <span class="sort-indicator">{{ '↑' if direction == 'asc' else '↓' }}</span>
                    {% endif %}
                </a>
            </th>
            <th>
                <a class="sort-link{% if sort == 'class_name' %} active{% endif %}"
                   href="{{ url_for('admin_dashboard', sort='class_name', direction=next_class_dir) }}">
                    Класс
                    {% if sort == 'class_name' %}
                        <span class="sort-indicator">{{ '↑' if direction == 'asc' else '↓' }}</span>
                    {% endif %}
                </a>
            </th>
            <th>
                <a class="sort-link{% if sort == 'faction' %} active{% endif %}"
                   href="{{ url_for('admin_dashboard', sort='faction', direction=next_faction_dir) }}">
                    Фракция
                    {% if sort == 'faction' %}
                        <span class="sort-indicator">{{ '↑' if direction == 'asc' else '↓' }}</span>
                    {% endif %}
                </a>
            </th>
            <th>
                <a class="sort-link{% if sort == 'overall_tier' %} active{% endif %}"
                   href="{{ url_for('admin_dashboard', sort='overall_tier', direction=next_overall_dir) }}">
                    Итоговый тир
                    {% if sort == 'overall_tier' %}
                        <span class="sort-indicator">{{ '↑' if direction == 'asc' else '↓' }}</span>
                    {% endif %}
                </a>
            </th>
        </tr>
        </thead>
        <tbody>
        {% for ch in characters %}
        <tr>
            <td>{{ ch.id }}</td>
            <td>{{ ch.name }}</td>
            <td>{{ ch.class_name or '—' }}</td>
            <td>{{ ch.faction or '—' }}</td>
            <td>{{ ch.overall_tier or '-' }}</td>
            <td>
                <a href="{{ url_for('admin_edit_character', char_id=ch.id) }}">Редактировать</a>
                <form method="post"
                      action="{{ url_for('admin_delete_character', char_id=ch.id) }}"
                      style="display:inline"
                      onsubmit="return confirm('Удалить персонажа?');">
                    <button type="submit">Удалить</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
