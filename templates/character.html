{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}{{ character.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='character.css') }}">
{% endblock %}

{% block content %}
<div class="card character-header">
    <div class="char-header-left">
        {{ macros.character_image(character.image_name, character.name, size='large', placeholder=character.name[0]) }}
    </div>
    <div class="char-header-right">
        <h1>{{ character.name }}</h1>
        <div class="char-meta-row">
            <p class="char-facts">
                <span>{{ character.class_name or '—' }}</span> ·
                <span>{{ character.faction or '—' }}</span>
            </p>
            {% if character.difficulty %}
                <span class="pill pill-muted">{{ character.difficulty }}</span>
            {% endif %}
        </div>
        {% if character.short_summary %}
            <p class="char-summary rich-text">{{ character.short_summary }}</p>
        {% endif %}
    </div>
</div>

<div class="tab-switch">
    <button class="tab-btn is-active" data-tab-target="profile">Профиль</button>
    <button class="tab-btn" data-tab-target="overview">Обзор</button>
</div>

<section class="tab-panel is-active" id="profile">
    <div class="card">
        <h2>Профиль</h2>
        <div class="info-grid">
            <div class="info-tile">
                <div class="tile-label">Фракция</div>
                <div class="tile-value">{{ character.faction or '—' }}</div>
            </div>
            <div class="info-tile">
                <div class="tile-label">Класс</div>
                <div class="tile-value">{{ character.class_name or '—' }}</div>
            </div>
            <div class="info-tile">
                <div class="tile-label">Сложность</div>
                <div class="tile-value">{{ character.difficulty or '—' }}</div>
            </div>
        </div>

        <div class="skills-grid">
            {% for group in skill_groups %}
                {% if group.skills %}
                    <div class="skill-group">
                        <div class="skill-group__title">
                            <span class="skill-chip">{{ group.label }}</span>
                        </div>
                        {% for s in group.skills %}
                            <div class="skill-card">
                                <div class="skill-card__top">
                                    <div>
                                        <div class="skill-name">{{ s.name }}</div>
                                        <div class="skill-meta">КД: {{ s.cooldown or "-" }}</div>
                                    </div>
                                    {% if s.valid_hits %}
                                        <span class="pill pill-soft">Попаданий: {{ s.valid_hits }}</span>
                                    {% endif %}
                                </div>
                                <div class="rich-text">{{ s.description }}</div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}

            {% for group in additional_skill_groups %}
                <div class="skill-group">
                    <div class="skill-group__title">
                        <span class="skill-chip">{{ group.label }}</span>
                    </div>
                    {% for s in group.skills %}
                        <div class="skill-card">
                            <div class="skill-card__top">
                                <div>
                                    <div class="skill-name">{{ s.name }}</div>
                                    <div class="skill-meta">КД: {{ s.cooldown or "-" }}</div>
                                </div>
                                {% if s.valid_hits %}
                                    <span class="pill pill-soft">Попаданий: {{ s.valid_hits }}</span>
                                {% endif %}
                            </div>
                            <div class="rich-text">{{ s.description }}</div>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}

            {% if not skills_by_type %}
                <p class="muted">Навыки пока не добавлены.</p>
            {% endif %}
        </div>
    </div>
</section>

<section class="tab-panel" id="overview">
    <div class="card">
        <h2>Обзор и оценки</h2>
        <div class="ratings-grid">
            <div class="rating-card">
                <div class="rating-label">Оружие</div>
                <div class="rating-value">{{ character.tier_weapon or '—' }}</div>
            </div>
            <div class="rating-card">
                <div class="rating-label">Навык</div>
                <div class="rating-value">{{ character.tier_skill or '—' }}</div>
            </div>
            <div class="rating-card">
                <div class="rating-label">Пассивка</div>
                <div class="rating-value">{{ character.tier_passive or '—' }}</div>
            </div>
            <div class="rating-card">
                <div class="rating-label">Ультимейт</div>
                <div class="rating-value">{{ character.tier_ultimate or '—' }}</div>
            </div>
        </div>

        <div class="difficulty-banner">
            <div>
                <div class="tile-label">Сложность освоения</div>
                <div class="tile-value">{{ character.difficulty or '—' }}</div>
            </div>
            {% if character.balance_status %}
                <span class="pill pill-soft">Баланс: {{ character.balance_status }}</span>
            {% endif %}
        </div>

        <div class="pros-cons">
            <div class="pros-cons__col">
                <h3>Плюсы</h3>
                {% if character.short_summary %}
                    <div class="rich-text">{{ character.short_summary }}</div>
                {% else %}
                    <p class="muted">Плюсы пока не добавлены.</p>
                {% endif %}
            </div>
            <div class="pros-cons__col">
                <h3>Минусы</h3>
                {% if character.review %}
                    <p class="muted">Минусы добавьте как отдельный блок в обзоре.</p>
                {% else %}
                    <p class="muted">Минусы пока не добавлены.</p>
                {% endif %}
            </div>
        </div>

        <div class="review-block">
            <h3>Ревью</h3>
            {% if character.review %}
                <div class="rich-text">{{ character.review }}</div>
            {% else %}
                <p class="muted">Обзор пока не добавлен.</p>
            {% endif %}
        </div>
    </div>
</section>

<script>
    const tabButtons = document.querySelectorAll('[data-tab-target]');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
            const target = btn.dataset.tabTarget;

            tabButtons.forEach((b) => b.classList.toggle('is-active', b === btn));
            tabPanels.forEach((panel) => {
                panel.classList.toggle('is-active', panel.id === target);
            });
        });
    });
</script>
{% endblock %}
